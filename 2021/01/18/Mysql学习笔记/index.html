<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  
    
      
    

    
  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|Roboto Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Notes,">










<meta name="description" content="mysql逻辑架构 连接层 最上层是一些客户端和连接服务，包含本地sock通信和大多数基于客户端/服务端工具实现的类似于tcp/ip的通信  服务层 第二层架构主要完成大多数的核心服务功能，如SQL接口，并完成缓存的查询，SQL的分析和优化及部分内置函数的执行  引擎层 存储引擎真正的负责了MYSQL中数据的存储和提取，服务器通过API与存储引擎进行通信  存储层 主要是将数据存储在运行于裸设备的">
<meta name="keywords" content="Notes">
<meta property="og:type" content="article">
<meta property="og:title" content="Mysql学习笔记">
<meta property="og:url" content="elssm.github.io/2021/01/18/Mysql学习笔记/index.html">
<meta property="og:site_name" content="ELSSM&#39;s Blog">
<meta property="og:description" content="mysql逻辑架构 连接层 最上层是一些客户端和连接服务，包含本地sock通信和大多数基于客户端/服务端工具实现的类似于tcp/ip的通信  服务层 第二层架构主要完成大多数的核心服务功能，如SQL接口，并完成缓存的查询，SQL的分析和优化及部分内置函数的执行  引擎层 存储引擎真正的负责了MYSQL中数据的存储和提取，服务器通过API与存储引擎进行通信  存储层 主要是将数据存储在运行于裸设备的">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2021-12-13T09:49:48.490Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Mysql学习笔记">
<meta name="twitter:description" content="mysql逻辑架构 连接层 最上层是一些客户端和连接服务，包含本地sock通信和大多数基于客户端/服务端工具实现的类似于tcp/ip的通信  服务层 第二层架构主要完成大多数的核心服务功能，如SQL接口，并完成缓存的查询，SQL的分析和优化及部分内置函数的执行  引擎层 存储引擎真正的负责了MYSQL中数据的存储和提取，服务器通过API与存储引擎进行通信  存储层 主要是将数据存储在运行于裸设备的">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="elssm.github.io/2021/01/18/Mysql学习笔记/">





  <title>Mysql学习笔记 | ELSSM's Blog</title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">ELSSM's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="elssm.github.io/2021/01/18/Mysql学习笔记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Elssm">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/author2.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ELSSM's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Mysql学习笔记</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-01-18T22:22:20+08:00">
                2021-01-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h4 id="mysql逻辑架构"><a href="#mysql逻辑架构" class="headerlink" title="mysql逻辑架构"></a>mysql逻辑架构</h4><ul>
<li><p>连接层</p>
<p>最上层是一些客户端和连接服务，包含本地sock通信和大多数基于客户端/服务端工具实现的类似于tcp/ip的通信</p>
</li>
<li><p>服务层</p>
<p>第二层架构主要完成大多数的核心服务功能，如SQL接口，并完成缓存的查询，SQL的分析和优化及部分内置函数的执行</p>
</li>
<li><p>引擎层</p>
<p>存储引擎真正的负责了MYSQL中数据的存储和提取，服务器通过API与存储引擎进行通信</p>
</li>
<li><p>存储层</p>
<p>主要是将数据存储在运行于裸设备的文件系统之上，并完成于存储引擎的交互</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> x <span class="keyword">from</span> tableA A <span class="keyword">left</span> <span class="keyword">join</span> tableB B <span class="keyword">on</span> A.key=B.key</span><br><span class="line"><span class="keyword">select</span> x <span class="keyword">from</span> tableA A <span class="keyword">right</span> <span class="keyword">join</span> tableB B <span class="keyword">on</span> A.key=B.key <span class="keyword">where</span> A.key <span class="keyword">is</span> <span class="literal">NULL</span></span><br><span class="line"><span class="keyword">select</span> x <span class="keyword">from</span> tableA A <span class="keyword">Full</span> <span class="keyword">outer</span> <span class="keyword">join</span> tableB <span class="keyword">on</span> A.key=B.key <span class="keyword">where</span> A.key <span class="keyword">is</span> <span class="literal">Null</span> <span class="keyword">or</span> B.key <span class="keyword">is</span> Bull</span><br></pre></td></tr></table></figure>
<p>建表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`tbl_dept`</span>(</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">INT</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`deptName`</span> <span class="built_in">VARCHAR</span>(<span class="number">30</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`locAdd`</span> <span class="built_in">VARCHAR</span>(<span class="number">40</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">)<span class="keyword">ENGINE</span>=<span class="keyword">INNODB</span> AUTO_INCREMENT=<span class="number">1</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`tbl_emp`</span>(</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">INT</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`name`</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`deptId`</span> <span class="built_in">INT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`fk_dept_id`</span> (<span class="string">`deptId`</span>)</span><br><span class="line">  <span class="comment">#CONSTRAINT `fk_dept_id` FOREIGN KEY (deptId) REFERENCES `tbl_dept` (`id`)</span></span><br><span class="line">)<span class="keyword">ENGINE</span>=<span class="keyword">INNODB</span> AUTO_INCREMENT=<span class="number">1</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>索引：索引是帮助MYSQL高效获取数据的数据结构（排好序的快速查找数据结构）</p>
<p>索引分类</p>
<ul>
<li><p>单值索引</p>
</li>
<li><p>唯一索引</p>
</li>
<li><p>复合索引</p>
</li>
<li><p>基本语法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">创建</span><br><span class="line">CREATE [UNIQUE] INDEX indexName ON mytable(columnname(length));</span><br><span class="line"></span><br><span class="line">ALTER mytable ADD [UNIQUE] INDEX [indexName] ON (columnname(length))</span><br><span class="line"></span><br><span class="line">删除</span><br><span class="line">DROP INDEX [indexName] ON mytable;</span><br><span class="line"></span><br><span class="line">查看</span><br><span class="line">SHOW INDEX FROM table_name\G</span><br></pre></td></tr></table></figure>
</li>
<li><p>哪些情况需要创建索引</p>
<p>主键自动建立唯一索引</p>
<p>频繁作为查询条件的字段应该创建索引</p>
<p>查询中与其他表关联的字段，外键关系建立索引</p>
<p>频繁更新的字段不适合创建索引</p>
<p>Where条件里用不到的字段不创建索引</p>
</li>
<li><p>哪些情况不需要创建索引</p>
<p>表记录太少</p>
<p>经常增删改的表</p>
<p>数据重复且分布平均的表字段</p>
</li>
<li><p>MYSQL常见瓶颈</p>
<p>CPU：CPU在饱和的时候一般发生在数据装入内存或从磁盘上读取数据时候</p>
<p>I/O：磁盘I/O瓶颈发生在装入数据远大于内存容量的时候</p>
<p>服务器硬件的性能瓶颈：top，free，uistat和vmstat来查看系统的性能状态</p>
</li>
<li><p>explain+SQL</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id|select_type|table|type|possible_keys|key|key_len|ref|rows|Extra</span><br></pre></td></tr></table></figure>
<ul>
<li>select_type<ul>
<li>SIMPLE：简单的select查询，不包含子查询或者UNION</li>
<li>PRIMARY：查询中若包含任何复杂的子部分，最外层查询被标记为</li>
<li>SUBQUERY：在SELECT或WHERE列表中国呢包含了子查询</li>
<li>DERIVED：在FROM列表中包含的子查询被标记为DERIVED(衍生)</li>
<li>UNION：若第二个SELECT出现在UNION之后，则被标记为UNION</li>
<li>UNION RESULT：从UNION表获取结果的SELECT</li>
</ul>
</li>
<li>type</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">system&gt;const&gt;eq_ref&gt;ref&gt;range&gt;index&gt;ALL</span><br></pre></td></tr></table></figure>
<ul>
<li>possible_keys：理论上应该用到哪些索引</li>
<li>key：真正用到的索引</li>
<li>ref：显示索引的哪一列被使用了，如果可能的话，是一个常数，哪些列或常量被用于查找索引列上的值</li>
<li>Extra（包含不适合在其他列中显示但十分重要的额外信息）<ul>
<li>Using filesort：说明mysql会对数据使用过一个外部的索引排序，而不是按照表内的索引顺序进行读取（文件内排序）</li>
<li>Using temporary：使用了临时表保存中间结果，mysql在对查询结果排序时使用临时表。 </li>
<li>Using index：表示相应的select操作中使用了覆盖索引，避免访问了表的数据行</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="索引失效（避免索引失效）"><a href="#索引失效（避免索引失效）" class="headerlink" title="索引失效（避免索引失效）"></a>索引失效（避免索引失效）</h4><ul>
<li>全局匹配我最爱</li>
<li>最佳左前缀法则</li>
<li>不在索引列上做任何操作，会导致索引失效转向全表扫描</li>
<li>存储引擎不能使用索引中范围条件右边的列</li>
<li>尽量使用覆盖索引，减少select *</li>
<li>mysql在使用不等于(!=或者&lt;&gt;)的时候无法使用索引会导致全表扫描</li>
<li>is null , is not null也无法使用索引</li>
<li>like以通配符开头(‘%abc…’)mysql索引失效会变成全表扫描的操作</li>
<li>字符串不加单引号索引失效</li>
<li><p>少用or，用它来连接时会索引失效</p>
</li>
<li><p>查询截取分析</p>
<ul>
<li>慢查询的开启与捕获</li>
<li>explain+慢SQL分析</li>
<li>show profile查询SQL在mysql服务器里面的执行细节和生命周期情况</li>
<li>SQL数据库服务器的参数调优</li>
</ul>
<p>优化原则：小表驱动大表</p>
<ul>
<li>当B表的数据集必须小于A表的数据集时，用in优于exists</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> A <span class="keyword">where</span> <span class="keyword">id</span> <span class="keyword">in</span> (<span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> B)</span><br></pre></td></tr></table></figure>
<ul>
<li>当A表的数据集必须小于B表的数据集时，用exists优于in</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> A <span class="keyword">where</span> <span class="keyword">exists</span> (<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> B <span class="keyword">where</span> B.id=A.id)</span><br></pre></td></tr></table></figure>
<ul>
<li><p>批量数据脚本</p>
<ul>
<li>建表</li>
<li>设置参数log_bin_trust_function_creators</li>
<li>创建函数，保证每条数据都不同</li>
<li>创建存储过程</li>
<li>调用存储过程</li>
</ul>
</li>
<li><p>MYSQL的表级锁有两种模式</p>
<ul>
<li><p>表共享读锁</p>
</li>
<li><p>表独占写锁</p>
</li>
</ul>
<p>读锁会阻塞写，但是不会堵塞读，而写锁会把读和写都堵塞。</p>
</li>
<li><p>并发事物处理带来的问题</p>
<ul>
<li><p>更新丢失：当两个或多个事务选择同一行，然后基于最初选定的值更新该行时，由于每个事务都不知道其他事务的存在，就会发生丢失更新问题。</p>
</li>
<li><p>脏读：事务A读取到了事务B已修改但尚未提交的数据。</p>
</li>
<li><p>不可重复读：事务A读取到了事务B已经提交的修改数据，不符合隔离性</p>
</li>
<li><p>幻读：事务A读取到了事务B已提交的新增数据，不符合隔离性。</p>
</li>
</ul>
</li>
<li><p>MYSQL事务隔离级别</p>
<ul>
<li>读未提交（read uncommitted）</li>
<li>读已提交（read committed）</li>
<li>可重复读（repeatable read）</li>
<li>可序列化（serializable）</li>
</ul>
</li>
<li><p>MYSQL复制过程分成三步</p>
<ul>
<li>master将change记录到二进制日志（binary log），这些记录过程叫做二进制日志事件，binary log events</li>
<li>slave将master的binary log events拷贝到它的中继日志（relay log）</li>
<li>slave重做中继日志中的事件，将改变应用到自己的数据库中，MYSQL复制是异步的且串行化的</li>
</ul>
</li>
</ul>
<h4 id="MySQL题目"><a href="#MySQL题目" class="headerlink" title="MySQL题目"></a>MySQL题目</h4><p>sql文件源码如下</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> EMP;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> DEPT;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> SALGRADE;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> DEPT</span><br><span class="line">       (DEPTNO <span class="built_in">int</span>(<span class="number">2</span>) <span class="keyword">not</span> <span class="literal">null</span> ,</span><br><span class="line">	DNAME <span class="built_in">VARCHAR</span>(<span class="number">14</span>) ,</span><br><span class="line">	LOC <span class="built_in">VARCHAR</span>(<span class="number">13</span>),</span><br><span class="line">	primary <span class="keyword">key</span> (DEPTNO)</span><br><span class="line">	);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> EMP</span><br><span class="line">       (EMPNO <span class="built_in">int</span>(<span class="number">4</span>)  <span class="keyword">not</span> <span class="literal">null</span> ,</span><br><span class="line">	ENAME <span class="built_in">VARCHAR</span>(<span class="number">10</span>),</span><br><span class="line">	JOB <span class="built_in">VARCHAR</span>(<span class="number">9</span>),</span><br><span class="line">	MGR <span class="built_in">INT</span>(<span class="number">4</span>),</span><br><span class="line">	HIREDATE <span class="built_in">DATE</span>  <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">	SAL <span class="keyword">DOUBLE</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line">	COMM <span class="keyword">DOUBLE</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line">	primary <span class="keyword">key</span> (EMPNO),</span><br><span class="line">	DEPTNO <span class="built_in">INT</span>(<span class="number">2</span>) </span><br><span class="line">	)</span><br><span class="line">	;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> SALGRADE</span><br><span class="line">      ( GRADE <span class="built_in">INT</span>,</span><br><span class="line">	LOSAL <span class="built_in">INT</span>,</span><br><span class="line">	HISAL <span class="built_in">INT</span> );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> DEPT ( DEPTNO, DNAME, LOC ) <span class="keyword">VALUES</span> ( </span><br><span class="line"><span class="number">10</span>, <span class="string">'ACCOUNTING'</span>, <span class="string">'NEW YORK'</span>); </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> DEPT ( DEPTNO, DNAME, LOC ) <span class="keyword">VALUES</span> ( </span><br><span class="line"><span class="number">20</span>, <span class="string">'RESEARCH'</span>, <span class="string">'DALLAS'</span>); </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> DEPT ( DEPTNO, DNAME, LOC ) <span class="keyword">VALUES</span> ( </span><br><span class="line"><span class="number">30</span>, <span class="string">'SALES'</span>, <span class="string">'CHICAGO'</span>); </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> DEPT ( DEPTNO, DNAME, LOC ) <span class="keyword">VALUES</span> ( </span><br><span class="line"><span class="number">40</span>, <span class="string">'OPERATIONS'</span>, <span class="string">'BOSTON'</span>); </span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> EMP ( EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM,</span><br><span class="line">DEPTNO ) <span class="keyword">VALUES</span> ( </span><br><span class="line"><span class="number">7369</span>, <span class="string">'SMITH'</span>, <span class="string">'CLERK'</span>, <span class="number">7902</span>,  <span class="string">'1980-12-17'</span></span><br><span class="line">, <span class="number">800</span>, <span class="literal">NULL</span>, <span class="number">20</span>); </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> EMP ( EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM,</span><br><span class="line">DEPTNO ) <span class="keyword">VALUES</span> ( </span><br><span class="line"><span class="number">7499</span>, <span class="string">'ALLEN'</span>, <span class="string">'SALESMAN'</span>, <span class="number">7698</span>,  <span class="string">'1981-02-20'</span></span><br><span class="line">, <span class="number">1600</span>, <span class="number">300</span>, <span class="number">30</span>); </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> EMP ( EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM,</span><br><span class="line">DEPTNO ) <span class="keyword">VALUES</span> ( </span><br><span class="line"><span class="number">7521</span>, <span class="string">'WARD'</span>, <span class="string">'SALESMAN'</span>, <span class="number">7698</span>,  <span class="string">'1981-02-22'</span></span><br><span class="line">, <span class="number">1250</span>, <span class="number">500</span>, <span class="number">30</span>); </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> EMP ( EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM,</span><br><span class="line">DEPTNO ) <span class="keyword">VALUES</span> ( </span><br><span class="line"><span class="number">7566</span>, <span class="string">'JONES'</span>, <span class="string">'MANAGER'</span>, <span class="number">7839</span>,  <span class="string">'1981-04-02'</span></span><br><span class="line">, <span class="number">2975</span>, <span class="literal">NULL</span>, <span class="number">20</span>); </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> EMP ( EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM,</span><br><span class="line">DEPTNO ) <span class="keyword">VALUES</span> ( </span><br><span class="line"><span class="number">7654</span>, <span class="string">'MARTIN'</span>, <span class="string">'SALESMAN'</span>, <span class="number">7698</span>,  <span class="string">'1981-09-28'</span></span><br><span class="line">, <span class="number">1250</span>, <span class="number">1400</span>, <span class="number">30</span>); </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> EMP ( EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM,</span><br><span class="line">DEPTNO ) <span class="keyword">VALUES</span> ( </span><br><span class="line"><span class="number">7698</span>, <span class="string">'BLAKE'</span>, <span class="string">'MANAGER'</span>, <span class="number">7839</span>,  <span class="string">'1981-05-01'</span></span><br><span class="line">, <span class="number">2850</span>, <span class="literal">NULL</span>, <span class="number">30</span>); </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> EMP ( EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM,</span><br><span class="line">DEPTNO ) <span class="keyword">VALUES</span> ( </span><br><span class="line"><span class="number">7782</span>, <span class="string">'CLARK'</span>, <span class="string">'MANAGER'</span>, <span class="number">7839</span>,  <span class="string">'1981-06-09'</span></span><br><span class="line">, <span class="number">2450</span>, <span class="literal">NULL</span>, <span class="number">10</span>); </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> EMP ( EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM,</span><br><span class="line">DEPTNO ) <span class="keyword">VALUES</span> ( </span><br><span class="line"><span class="number">7788</span>, <span class="string">'SCOTT'</span>, <span class="string">'ANALYST'</span>, <span class="number">7566</span>,  <span class="string">'1987-04-19'</span></span><br><span class="line">, <span class="number">3000</span>, <span class="literal">NULL</span>, <span class="number">20</span>); </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> EMP ( EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM,</span><br><span class="line">DEPTNO ) <span class="keyword">VALUES</span> ( </span><br><span class="line"><span class="number">7839</span>, <span class="string">'KING'</span>, <span class="string">'PRESIDENT'</span>, <span class="literal">NULL</span>,  <span class="string">'1981-11-17'</span></span><br><span class="line">, <span class="number">5000</span>, <span class="literal">NULL</span>, <span class="number">10</span>); </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> EMP ( EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM,</span><br><span class="line">DEPTNO ) <span class="keyword">VALUES</span> ( </span><br><span class="line"><span class="number">7844</span>, <span class="string">'TURNER'</span>, <span class="string">'SALESMAN'</span>, <span class="number">7698</span>,  <span class="string">'1981-09-08'</span></span><br><span class="line">, <span class="number">1500</span>, <span class="number">0</span>, <span class="number">30</span>); </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> EMP ( EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM,</span><br><span class="line">DEPTNO ) <span class="keyword">VALUES</span> ( </span><br><span class="line"><span class="number">7876</span>, <span class="string">'ADAMS'</span>, <span class="string">'CLERK'</span>, <span class="number">7788</span>,  <span class="string">'1987-05-23'</span></span><br><span class="line">, <span class="number">1100</span>, <span class="literal">NULL</span>, <span class="number">20</span>); </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> EMP ( EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM,</span><br><span class="line">DEPTNO ) <span class="keyword">VALUES</span> ( </span><br><span class="line"><span class="number">7900</span>, <span class="string">'JAMES'</span>, <span class="string">'CLERK'</span>, <span class="number">7698</span>,  <span class="string">'1981-12-03'</span></span><br><span class="line">, <span class="number">950</span>, <span class="literal">NULL</span>, <span class="number">30</span>); </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> EMP ( EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM,</span><br><span class="line">DEPTNO ) <span class="keyword">VALUES</span> ( </span><br><span class="line"><span class="number">7902</span>, <span class="string">'FORD'</span>, <span class="string">'ANALYST'</span>, <span class="number">7566</span>,  <span class="string">'1981-12-03'</span></span><br><span class="line">, <span class="number">3000</span>, <span class="literal">NULL</span>, <span class="number">20</span>); </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> EMP ( EMPNO, ENAME, JOB, MGR, HIREDATE, SAL, COMM,</span><br><span class="line">DEPTNO ) <span class="keyword">VALUES</span> ( </span><br><span class="line"><span class="number">7934</span>, <span class="string">'MILLER'</span>, <span class="string">'CLERK'</span>, <span class="number">7782</span>,  <span class="string">'1982-01-23'</span></span><br><span class="line">, <span class="number">1300</span>, <span class="literal">NULL</span>, <span class="number">10</span>); </span><br><span class="line"><span class="keyword">commit</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> SALGRADE ( GRADE, LOSAL, HISAL ) <span class="keyword">VALUES</span> ( </span><br><span class="line"><span class="number">1</span>, <span class="number">700</span>, <span class="number">1200</span>); </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> SALGRADE ( GRADE, LOSAL, HISAL ) <span class="keyword">VALUES</span> ( </span><br><span class="line"><span class="number">2</span>, <span class="number">1201</span>, <span class="number">1400</span>); </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> SALGRADE ( GRADE, LOSAL, HISAL ) <span class="keyword">VALUES</span> ( </span><br><span class="line"><span class="number">3</span>, <span class="number">1401</span>, <span class="number">2000</span>); </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> SALGRADE ( GRADE, LOSAL, HISAL ) <span class="keyword">VALUES</span> ( </span><br><span class="line"><span class="number">4</span>, <span class="number">2001</span>, <span class="number">3000</span>); </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> SALGRADE ( GRADE, LOSAL, HISAL ) <span class="keyword">VALUES</span> ( </span><br><span class="line"><span class="number">5</span>, <span class="number">3001</span>, <span class="number">9999</span>); </span><br><span class="line"><span class="keyword">commit</span>;</span><br></pre></td></tr></table></figure>
<p><code>source</code>加载数据库表</p>
<h5 id="取得每个部门最高薪水的人员名称"><a href="#取得每个部门最高薪水的人员名称" class="headerlink" title="取得每个部门最高薪水的人员名称"></a>取得每个部门最高薪水的人员名称</h5><p>首先取得每个部门的最高薪水</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select deptno,max(sal) as maxsal from emp group by deptno;</span><br><span class="line">+<span class="comment">--------+---------+</span></span><br><span class="line">| deptno | maxsal  |</span><br><span class="line">+<span class="comment">--------+---------+</span></span><br><span class="line">|     20 | 3000.00 |</span><br><span class="line">|     30 | 2850.00 |</span><br><span class="line">|     10 | 5000.00 |</span><br><span class="line">+<span class="comment">--------+---------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>将以上的查询结果最为一张临时表t和emp表进行连接，查询条件是<code>t.deptno=e.deptno and t.maxsal=e.sal</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select e.ename,t.* </span><br><span class="line">    -&gt; from emp e</span><br><span class="line">    -&gt; join</span><br><span class="line">    -&gt; (select deptno,max(sal) as maxsal from emp group by deptno) t</span><br><span class="line">    -&gt; on </span><br><span class="line">    -&gt; t.deptno=e.deptno and t.maxsal=e.sal;</span><br><span class="line">+<span class="comment">-------+--------+---------+</span></span><br><span class="line">| ename | deptno | maxsal  |</span><br><span class="line">+<span class="comment">-------+--------+---------+</span></span><br><span class="line">| BLAKE |     30 | 2850.00 |</span><br><span class="line">| SCOTT |     20 | 3000.00 |</span><br><span class="line">| KING  |     10 | 5000.00 |</span><br><span class="line">| FORD  |     20 | 3000.00 |</span><br><span class="line">+<span class="comment">-------+--------+---------+</span></span><br><span class="line">4 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<h5 id="哪些人的薪水在部门的平均薪水之上"><a href="#哪些人的薪水在部门的平均薪水之上" class="headerlink" title="哪些人的薪水在部门的平均薪水之上"></a>哪些人的薪水在部门的平均薪水之上</h5><p>首先取得每个部门的平均薪水</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select deptno,avg(sal) as avgsal from emp group by deptno;</span><br><span class="line">+<span class="comment">--------+-------------+</span></span><br><span class="line">| deptno | avgsal      |</span><br><span class="line">+<span class="comment">--------+-------------+</span></span><br><span class="line">|     20 | 2175.000000 |</span><br><span class="line">|     30 | 1566.666667 |</span><br><span class="line">|     10 | 2916.666667 |</span><br><span class="line">+<span class="comment">--------+-------------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>将以上的查询结果最为一张临时表t和emp表进行连接，查询条件是<code>t.deptno=e.deptno and e.sal&gt;t.avgsal</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select e.ename,e.sal,t.*</span><br><span class="line">    -&gt; from emp e</span><br><span class="line">    -&gt; join</span><br><span class="line">    -&gt; (select deptno,avg(sal) as avgsal from emp group by deptno) t</span><br><span class="line">    -&gt; on</span><br><span class="line">    -&gt; e.deptno=t.deptno and e.sal&gt;t.avgsal;</span><br><span class="line">+<span class="comment">-------+---------+--------+-------------+</span></span><br><span class="line">| ename | sal     | deptno | avgsal      |</span><br><span class="line">+<span class="comment">-------+---------+--------+-------------+</span></span><br><span class="line">| ALLEN | 1600.00 |     30 | 1566.666667 |</span><br><span class="line">| JONES | 2975.00 |     20 | 2175.000000 |</span><br><span class="line">| BLAKE | 2850.00 |     30 | 1566.666667 |</span><br><span class="line">| SCOTT | 3000.00 |     20 | 2175.000000 |</span><br><span class="line">| KING  | 5000.00 |     10 | 2916.666667 |</span><br><span class="line">| FORD  | 3000.00 |     20 | 2175.000000 |</span><br><span class="line">+<span class="comment">-------+---------+--------+-------------+</span></span><br><span class="line">6 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<h5 id="取得部门中-所有人的-平均的薪水等级"><a href="#取得部门中-所有人的-平均的薪水等级" class="headerlink" title="取得部门中(所有人的)平均的薪水等级"></a>取得部门中(所有人的)平均的薪水等级</h5><p>第一步先找出每个员工的薪水等级</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select e.ename,e.sal,e.deptno,s.grade</span><br><span class="line">    -&gt; from emp e</span><br><span class="line">    -&gt; join</span><br><span class="line">    -&gt; salgrade s</span><br><span class="line">    -&gt; on </span><br><span class="line">    -&gt; e.sal between s.losal and s.hisal;</span><br><span class="line">+<span class="comment">--------+---------+--------+-------+</span></span><br><span class="line">| ename  | sal     | deptno | grade |</span><br><span class="line">+<span class="comment">--------+---------+--------+-------+</span></span><br><span class="line">| SMITH  |  800.00 |     20 |     1 |</span><br><span class="line">| ALLEN  | 1600.00 |     30 |     3 |</span><br><span class="line">| WARD   | 1250.00 |     30 |     2 |</span><br><span class="line">| JONES  | 2975.00 |     20 |     4 |</span><br><span class="line">| MARTIN | 1250.00 |     30 |     2 |</span><br><span class="line">| BLAKE  | 2850.00 |     30 |     4 |</span><br><span class="line">| CLARK  | 2450.00 |     10 |     4 |</span><br><span class="line">| SCOTT  | 3000.00 |     20 |     4 |</span><br><span class="line">| KING   | 5000.00 |     10 |     5 |</span><br><span class="line">| TURNER | 1500.00 |     30 |     3 |</span><br><span class="line">| ADAMS  | 1100.00 |     20 |     1 |</span><br><span class="line">| JAMES  |  950.00 |     30 |     1 |</span><br><span class="line">| FORD   | 3000.00 |     20 |     4 |</span><br><span class="line">| MILLER | 1300.00 |     10 |     2 |</span><br><span class="line">+<span class="comment">--------+---------+--------+-------+</span></span><br><span class="line">14 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>基于上面的表按照部门编号分组之后求grade的平均值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select e.deptno,avg(s.grade)</span><br><span class="line">    -&gt; from emp e</span><br><span class="line">    -&gt; join</span><br><span class="line">    -&gt; salgrade s</span><br><span class="line">    -&gt; on e.sal between s.losal and s.hisal</span><br><span class="line">    -&gt; group by</span><br><span class="line">    -&gt; e.deptno;</span><br><span class="line">+<span class="comment">--------+--------------+</span></span><br><span class="line">| deptno | avg(s.grade) |</span><br><span class="line">+<span class="comment">--------+--------------+</span></span><br><span class="line">|     20 |       2.8000 |</span><br><span class="line">|     30 |       2.5000 |</span><br><span class="line">|     10 |       3.6667 |</span><br><span class="line">+<span class="comment">--------+--------------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<h5 id="不使用max函数，取得最高薪水"><a href="#不使用max函数，取得最高薪水" class="headerlink" title="不使用max函数，取得最高薪水"></a>不使用max函数，取得最高薪水</h5><p>降序之后limit</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select ename,sal from emp order by sal desc limit 1;</span><br><span class="line">+<span class="comment">-------+---------+</span></span><br><span class="line">| ename | sal     |</span><br><span class="line">+<span class="comment">-------+---------+</span></span><br><span class="line">| KING  | 5000.00 |</span><br><span class="line">+<span class="comment">-------+---------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>表的自连接</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select sal from emp where sal not in (select distinct a.sal from emp a jo</span><br><span class="line">in emp b on a.sal &lt; b.sal);</span><br><span class="line">+<span class="comment">---------+</span></span><br><span class="line">| sal     |</span><br><span class="line">+<span class="comment">---------+</span></span><br><span class="line">| 5000.00 |</span><br><span class="line">+<span class="comment">---------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<h5 id="取得平均薪水最高的部门的部门编号"><a href="#取得平均薪水最高的部门的部门编号" class="headerlink" title="取得平均薪水最高的部门的部门编号"></a>取得平均薪水最高的部门的部门编号</h5><p>第一步找出每个部门的平均薪水</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select deptno,avg(sal) as avgsal from emp group by deptno;</span><br><span class="line">+<span class="comment">--------+-------------+</span></span><br><span class="line">| deptno | avgsal      |</span><br><span class="line">+<span class="comment">--------+-------------+</span></span><br><span class="line">|     20 | 2175.000000 |</span><br><span class="line">|     30 | 1566.666667 |</span><br><span class="line">|     10 | 2916.666667 |</span><br><span class="line">+<span class="comment">--------+-------------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>第二步找出薪水最高的部门编号</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select deptno,avg(sal) as avgsal from emp group by deptno order by avgsal desc limit 1;</span><br><span class="line">+<span class="comment">--------+-------------+</span></span><br><span class="line">| deptno | avgsal      |</span><br><span class="line">+<span class="comment">--------+-------------+</span></span><br><span class="line">|     10 | 2916.666667 |</span><br><span class="line">+<span class="comment">--------+-------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<h5 id="取得平均薪水最高的部门的部门名称"><a href="#取得平均薪水最高的部门的部门名称" class="headerlink" title="取得平均薪水最高的部门的部门名称"></a>取得平均薪水最高的部门的部门名称</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select</span><br><span class="line">    -&gt; d.dname,avg(e.sal) as avgsal</span><br><span class="line">    -&gt; from</span><br><span class="line">    -&gt; emp e</span><br><span class="line">    -&gt; join</span><br><span class="line">    -&gt; dept d</span><br><span class="line">    -&gt; on</span><br><span class="line">    -&gt; e.deptno=d.deptno</span><br><span class="line">    -&gt; group by d.dname</span><br><span class="line">    -&gt; order by avgsal desc</span><br><span class="line">    -&gt; limit 1;</span><br><span class="line">+<span class="comment">------------+-------------+</span></span><br><span class="line">| dname      | avgsal      |</span><br><span class="line">+<span class="comment">------------+-------------+</span></span><br><span class="line">| ACCOUNTING | 2916.666667 |</span><br><span class="line">+<span class="comment">------------+-------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<h5 id="找出平均薪水的等级最低的部门的部门名称"><a href="#找出平均薪水的等级最低的部门的部门名称" class="headerlink" title="找出平均薪水的等级最低的部门的部门名称"></a>找出平均薪水的等级最低的部门的部门名称</h5><p>第一步，找出每个部门的平均薪水</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select  d.dname,avg(e.sal) from dept d join emp e on e.deptno=d.deptno group by d.dname;</span><br><span class="line">+<span class="comment">------------+-------------+</span></span><br><span class="line">| dname      | avg(e.sal)  |</span><br><span class="line">+<span class="comment">------------+-------------+</span></span><br><span class="line">| RESEARCH   | 2175.000000 |</span><br><span class="line">| SALES      | 1566.666667 |</span><br><span class="line">| ACCOUNTING | 2916.666667 |</span><br><span class="line">+<span class="comment">------------+-------------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>第二步，将上述表和salgrade表连接找出每个部门的平均薪水的等级</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select t.dname,s.grade,t.avgsal</span><br><span class="line">    -&gt; from salgrade s</span><br><span class="line">    -&gt; join</span><br><span class="line">    -&gt; (select d.dname,avg(e.sal) as avgsal from dept d join emp e on e.deptno=d.deptno group by d.dname) t</span><br><span class="line">    -&gt; on t.avgsal between s.losal and s.hisal;</span><br><span class="line">+<span class="comment">------------+-------+-------------+</span></span><br><span class="line">| dname      | grade | avgsal      |</span><br><span class="line">+<span class="comment">------------+-------+-------------+</span></span><br><span class="line">| RESEARCH   |     4 | 2175.000000 |</span><br><span class="line">| SALES      |     3 | 1566.666667 |</span><br><span class="line">| ACCOUNTING |     4 | 2916.666667 |</span><br><span class="line">+<span class="comment">------------+-------+-------------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>第三步，找出最低等级</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select grade</span><br><span class="line">    -&gt; from salgrade </span><br><span class="line">    -&gt; where </span><br><span class="line">    -&gt; (select avg(sal) as avgsal from emp group by deptno order by avgsal asc limit 1)</span><br><span class="line">    -&gt; between losal and hisal;</span><br><span class="line">+<span class="comment">-------+</span></span><br><span class="line">| grade |</span><br><span class="line">+<span class="comment">-------+</span></span><br><span class="line">|     3 |</span><br><span class="line">+<span class="comment">-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>第四步，给第二步得到的表加一个<code>grade=3</code>的限制条件</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select t.dname,s.grade,t.avgsal</span><br><span class="line">    -&gt; from salgrade s</span><br><span class="line">    -&gt; join</span><br><span class="line">    -&gt; (select d.dname,avg(e.sal) as avgsal from dept d join emp e on e.deptno=d.deptno group by d.dname) t</span><br><span class="line">    -&gt; on t.avgsal between s.losal and s.hisal</span><br><span class="line">    -&gt; where s.grade=(select grade from salgrade where (select avg(sal) as avgsal from emp group by deptno order by avgsal asc limit 1) between losal and hisal);</span><br><span class="line">+<span class="comment">-------+-------+-------------+</span></span><br><span class="line">| dname | grade | avgsal      |</span><br><span class="line">+<span class="comment">-------+-------+-------------+</span></span><br><span class="line">| SALES |     3 | 1566.666667 |</span><br><span class="line">+<span class="comment">-------+-------+-------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<h5 id="取出比普通员工-员工代码没有在mgr字段上出现的-的最高薪水还要高的领导人姓名"><a href="#取出比普通员工-员工代码没有在mgr字段上出现的-的最高薪水还要高的领导人姓名" class="headerlink" title="取出比普通员工(员工代码没有在mgr字段上出现的)的最高薪水还要高的领导人姓名"></a>取出比普通员工(员工代码没有在mgr字段上出现的)的最高薪水还要高的领导人姓名</h5><p>第一步，找出员工代码在mgr字段上出现的，排除NULL</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select distinct mgr from emp where mgr is not null;</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| mgr  |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| 7902 |</span><br><span class="line">| 7698 |</span><br><span class="line">| 7839 |</span><br><span class="line">| 7566 |</span><br><span class="line">| 7788 |</span><br><span class="line">| 7782 |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">6 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>第二步，找出普通员工的最高薪水</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select max(sal) from emp where empno not in (select distinct mgr from emp where mgr is not null);</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">| max(sal) |</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">|  1600.00 |</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>第三步，找出薪资高于1600的</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select ename,sal</span><br><span class="line">    -&gt; from emp</span><br><span class="line">    -&gt; where </span><br><span class="line">    -&gt; sal &gt;(select max(sal) from emp where empno not in (select distinct mgr from emp where mgr is not null));</span><br><span class="line">+<span class="comment">-------+---------+</span></span><br><span class="line">| ename | sal     |</span><br><span class="line">+<span class="comment">-------+---------+</span></span><br><span class="line">| JONES | 2975.00 |</span><br><span class="line">| BLAKE | 2850.00 |</span><br><span class="line">| CLARK | 2450.00 |</span><br><span class="line">| SCOTT | 3000.00 |</span><br><span class="line">| KING  | 5000.00 |</span><br><span class="line">| FORD  | 3000.00 |</span><br><span class="line">+<span class="comment">-------+---------+</span></span><br><span class="line">6 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<h5 id="取得每个薪水等级有多少员工"><a href="#取得每个薪水等级有多少员工" class="headerlink" title="取得每个薪水等级有多少员工"></a>取得每个薪水等级有多少员工</h5><p>第一步，获取每个员工的薪水等级</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select e.ename,e.sal,s.grade</span><br><span class="line">    -&gt; from emp e</span><br><span class="line">    -&gt; join </span><br><span class="line">    -&gt; salgrade s</span><br><span class="line">    -&gt; on e.sal between s.losal and s.hisal;</span><br><span class="line">+<span class="comment">--------+---------+-------+</span></span><br><span class="line">| ename  | sal     | grade |</span><br><span class="line">+<span class="comment">--------+---------+-------+</span></span><br><span class="line">| SMITH  |  800.00 |     1 |</span><br><span class="line">| ALLEN  | 1600.00 |     3 |</span><br><span class="line">| WARD   | 1250.00 |     2 |</span><br><span class="line">| JONES  | 2975.00 |     4 |</span><br><span class="line">| MARTIN | 1250.00 |     2 |</span><br><span class="line">| BLAKE  | 2850.00 |     4 |</span><br><span class="line">| CLARK  | 2450.00 |     4 |</span><br><span class="line">| SCOTT  | 3000.00 |     4 |</span><br><span class="line">| KING   | 5000.00 |     5 |</span><br><span class="line">| TURNER | 1500.00 |     3 |</span><br><span class="line">| ADAMS  | 1100.00 |     1 |</span><br><span class="line">| JAMES  |  950.00 |     1 |</span><br><span class="line">| FORD   | 3000.00 |     4 |</span><br><span class="line">| MILLER | 1300.00 |     2 |</span><br><span class="line">+<span class="comment">--------+---------+-------+</span></span><br><span class="line">14 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>根据上述表，对等级进行分组，并统计每个分组的人数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select t.grade,count(t.grade)</span><br><span class="line">    -&gt; from </span><br><span class="line">    -&gt; (select e.ename,e.sal,s.grade from emp e join salgrade s on e.sal between s.losal and s.hisal) t</span><br><span class="line">    -&gt; group by t.grade;</span><br><span class="line">+<span class="comment">-------+----------------+</span></span><br><span class="line">| grade | count(t.grade) |</span><br><span class="line">+<span class="comment">-------+----------------+</span></span><br><span class="line">|     1 |              3 |</span><br><span class="line">|     3 |              2 |</span><br><span class="line">|     2 |              3 |</span><br><span class="line">|     4 |              5 |</span><br><span class="line">|     5 |              1 |</span><br><span class="line">+<span class="comment">-------+----------------+</span></span><br><span class="line">5 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<h5 id="列出所有员工及领导的姓名"><a href="#列出所有员工及领导的姓名" class="headerlink" title="列出所有员工及领导的姓名"></a>列出所有员工及领导的姓名</h5><p>使用左外连接</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select</span><br><span class="line">    -&gt; a.ename '员工',b.ename '领导'</span><br><span class="line">    -&gt; from</span><br><span class="line">    -&gt; emp a</span><br><span class="line">    -&gt; left join</span><br><span class="line">    -&gt; emp b</span><br><span class="line">    -&gt; on a.mgr=b.empno;</span><br><span class="line">+<span class="comment">--------+--------+</span></span><br><span class="line">| 员工   | 领导    |</span><br><span class="line">+<span class="comment">--------+--------+</span></span><br><span class="line">| SMITH  | FORD   |</span><br><span class="line">| ALLEN  | BLAKE  |</span><br><span class="line">| WARD   | BLAKE  |</span><br><span class="line">| JONES  | KING   |</span><br><span class="line">| MARTIN | BLAKE  |</span><br><span class="line">| BLAKE  | KING   |</span><br><span class="line">| CLARK  | KING   |</span><br><span class="line">| SCOTT  | JONES  |</span><br><span class="line">| KING   | NULL   |</span><br><span class="line">| TURNER | BLAKE  |</span><br><span class="line">| ADAMS  | SCOTT  |</span><br><span class="line">| JAMES  | BLAKE  |</span><br><span class="line">| FORD   | JONES  |</span><br><span class="line">| MILLER | CLARK  |</span><br><span class="line">+<span class="comment">--------+--------+</span></span><br><span class="line">14 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<h5 id="找出受雇日期早于其直接上级的所有员工的编号，姓名，部门名称"><a href="#找出受雇日期早于其直接上级的所有员工的编号，姓名，部门名称" class="headerlink" title="找出受雇日期早于其直接上级的所有员工的编号，姓名，部门名称"></a>找出受雇日期早于其直接上级的所有员工的编号，姓名，部门名称</h5><p>第一步，找出受雇日期早于其直接上级的所有员工和领导</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select a.ename,a.hiredate,b.ename,b.hiredate</span><br><span class="line">    -&gt; from emp a</span><br><span class="line">    -&gt; left join emp b</span><br><span class="line">    -&gt; on a.mgr = b.empno</span><br><span class="line">    -&gt; where a.hiredate &lt; b.hiredate;</span><br><span class="line">+<span class="comment">-------+------------+-------+------------+</span></span><br><span class="line">| ename | hiredate   | ename | hiredate   |</span><br><span class="line">+<span class="comment">-------+------------+-------+------------+</span></span><br><span class="line">| SMITH | 1980-12-17 | FORD  | 1981-12-03 |</span><br><span class="line">| ALLEN | 1981-02-20 | BLAKE | 1981-05-01 |</span><br><span class="line">| WARD  | 1981-02-22 | BLAKE | 1981-05-01 |</span><br><span class="line">| JONES | 1981-04-02 | KING  | 1981-11-17 |</span><br><span class="line">| BLAKE | 1981-05-01 | KING  | 1981-11-17 |</span><br><span class="line">| CLARK | 1981-06-09 | KING  | 1981-11-17 |</span><br><span class="line">+<span class="comment">-------+------------+-------+------------+</span></span><br><span class="line">6 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>第二步，找出员工的编号和部门编号</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select a.ename,a.empno,a.deptno,a.hiredate,b.ename,b.hiredate</span><br><span class="line">    -&gt; from emp a</span><br><span class="line">    -&gt; left join emp b</span><br><span class="line">    -&gt; on a.mgr=b.empno</span><br><span class="line">    -&gt; where a.hiredate&lt;b.hiredate;</span><br><span class="line">+<span class="comment">-------+-------+--------+------------+-------+------------+</span></span><br><span class="line">| ename | empno | deptno | hiredate   | ename | hiredate   |</span><br><span class="line">+<span class="comment">-------+-------+--------+------------+-------+------------+</span></span><br><span class="line">| SMITH |  7369 |     20 | 1980-12-17 | FORD  | 1981-12-03 |</span><br><span class="line">| ALLEN |  7499 |     30 | 1981-02-20 | BLAKE | 1981-05-01 |</span><br><span class="line">| WARD  |  7521 |     30 | 1981-02-22 | BLAKE | 1981-05-01 |</span><br><span class="line">| JONES |  7566 |     20 | 1981-04-02 | KING  | 1981-11-17 |</span><br><span class="line">| BLAKE |  7698 |     30 | 1981-05-01 | KING  | 1981-11-17 |</span><br><span class="line">| CLARK |  7782 |     10 | 1981-06-09 | KING  | 1981-11-17 |</span><br><span class="line">+<span class="comment">-------+-------+--------+------------+-------+------------+</span></span><br><span class="line">6 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>连接部门表根据部门编号找出员工所在部门</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select a.ename,a.empno,d.dname</span><br><span class="line">    -&gt; from emp a </span><br><span class="line">    -&gt; left join emp b</span><br><span class="line">    -&gt; on a.mgr=b.empno</span><br><span class="line">    -&gt; join dept d</span><br><span class="line">    -&gt; on a.deptno = d.deptno</span><br><span class="line">    -&gt; where a.hiredate&lt;b.hiredate;</span><br><span class="line">+<span class="comment">-------+-------+------------+</span></span><br><span class="line">| ename | empno | dname      |</span><br><span class="line">+<span class="comment">-------+-------+------------+</span></span><br><span class="line">| SMITH |  7369 | RESEARCH   |</span><br><span class="line">| ALLEN |  7499 | SALES      |</span><br><span class="line">| WARD  |  7521 | SALES      |</span><br><span class="line">| JONES |  7566 | RESEARCH   |</span><br><span class="line">| BLAKE |  7698 | SALES      |</span><br><span class="line">| CLARK |  7782 | ACCOUNTING |</span><br><span class="line">+<span class="comment">-------+-------+------------+</span></span><br><span class="line">6 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<h5 id="列出部门名称和这些部门的员工信息"><a href="#列出部门名称和这些部门的员工信息" class="headerlink" title="列出部门名称和这些部门的员工信息"></a>列出部门名称和这些部门的员工信息</h5><p>使用外连接</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select</span><br><span class="line">    -&gt; e.*,d.dname</span><br><span class="line">    -&gt; from emp e</span><br><span class="line">    -&gt; right join</span><br><span class="line">    -&gt; dept d</span><br><span class="line">    -&gt; on e.deptno=d.deptno;</span><br><span class="line">+<span class="comment">-------+--------+-----------+------+------------+---------+---------+--------+------------+</span></span><br><span class="line">| EMPNO | ENAME  | JOB       | MGR  | HIREDATE   | SAL     | COMM    | DEPTNO | dname      |</span><br><span class="line">+<span class="comment">-------+--------+-----------+------+------------+---------+---------+--------+------------+</span></span><br><span class="line">|  7934 | MILLER | CLERK     | 7782 | 1982-01-23 | 1300.00 |    NULL |     10 | ACCOUNTING |</span><br><span class="line">|  7839 | KING   | PRESIDENT | NULL | 1981-11-17 | 5000.00 |    NULL |     10 | ACCOUNTING |</span><br><span class="line">|  7782 | CLARK  | MANAGER   | 7839 | 1981-06-09 | 2450.00 |    NULL |     10 | ACCOUNTING |</span><br><span class="line">|  7902 | FORD   | ANALYST   | 7566 | 1981-12-03 | 3000.00 |    NULL |     20 | RESEARCH   |</span><br><span class="line">|  7876 | ADAMS  | CLERK     | 7788 | 1987-05-23 | 1100.00 |    NULL |     20 | RESEARCH   |</span><br><span class="line">|  7788 | SCOTT  | ANALYST   | 7566 | 1987-04-19 | 3000.00 |    NULL |     20 | RESEARCH   |</span><br><span class="line">|  7566 | JONES  | MANAGER   | 7839 | 1981-04-02 | 2975.00 |    NULL |     20 | RESEARCH   |</span><br><span class="line">|  7369 | SMITH  | CLERK     | 7902 | 1980-12-17 |  800.00 |    NULL |     20 | RESEARCH   |</span><br><span class="line">|  7900 | JAMES  | CLERK     | 7698 | 1981-12-03 |  950.00 |    NULL |     30 | SALES      |</span><br><span class="line">|  7844 | TURNER | SALESMAN  | 7698 | 1981-09-08 | 1500.00 |    0.00 |     30 | SALES      |</span><br><span class="line">|  7698 | BLAKE  | MANAGER   | 7839 | 1981-05-01 | 2850.00 |    NULL |     30 | SALES      |</span><br><span class="line">|  7654 | MARTIN | SALESMAN  | 7698 | 1981-09-28 | 1250.00 | 1400.00 |     30 | SALES      |</span><br><span class="line">|  7521 | WARD   | SALESMAN  | 7698 | 1981-02-22 | 1250.00 |  500.00 |     30 | SALES      |</span><br><span class="line">|  7499 | ALLEN  | SALESMAN  | 7698 | 1981-02-20 | 1600.00 |  300.00 |     30 | SALES      |</span><br><span class="line">|  NULL | NULL   | NULL      | NULL | NULL       |    NULL |    NULL |   NULL | OPERATIONS |</span><br><span class="line">+<span class="comment">-------+--------+-----------+------+------------+---------+---------+--------+------------+</span></span><br><span class="line">15 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<h5 id="列出至少有5个员工的所有部门"><a href="#列出至少有5个员工的所有部门" class="headerlink" title="列出至少有5个员工的所有部门"></a>列出至少有5个员工的所有部门</h5><p>第一步，按照部门编号进行分组计数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select count(deptno) from emp group by deptno;</span><br><span class="line">+<span class="comment">---------------+</span></span><br><span class="line">| count(deptno) |</span><br><span class="line">+<span class="comment">---------------+</span></span><br><span class="line">|             5 |</span><br><span class="line">|             6 |</span><br><span class="line">|             3 |</span><br><span class="line">+<span class="comment">---------------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>连接dept表，列出部门名称</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select d.dname,count(e.deptno) from emp e join dept d on e.deptno=d.deptno  group by e.deptno;</span><br><span class="line">+<span class="comment">------------+-----------------+</span></span><br><span class="line">| dname      | count(e.deptno) |</span><br><span class="line">+<span class="comment">------------+-----------------+</span></span><br><span class="line">| RESEARCH   |               5 |</span><br><span class="line">| SALES      |               6 |</span><br><span class="line">| ACCOUNTING |               3 |</span><br><span class="line">+<span class="comment">------------+-----------------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>使用<code>having</code>找出至少有5个员工的部门</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select d.dname,count(e.deptno)</span><br><span class="line">    -&gt; from emp e</span><br><span class="line">    -&gt; join dept d on e.deptno=d.deptno</span><br><span class="line">    -&gt; group by e.deptno</span><br><span class="line">    -&gt; having count(e.deptno)&gt;=5;</span><br><span class="line">+<span class="comment">----------+-----------------+</span></span><br><span class="line">| dname    | count(e.deptno) |</span><br><span class="line">+<span class="comment">----------+-----------------+</span></span><br><span class="line">| RESEARCH |               5 |</span><br><span class="line">| SALES    |               6 |</span><br><span class="line">+<span class="comment">----------+-----------------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<h5 id="列出薪资比’SMITH’多的所有员工信息"><a href="#列出薪资比’SMITH’多的所有员工信息" class="headerlink" title="列出薪资比’SMITH’多的所有员工信息"></a>列出薪资比’SMITH’多的所有员工信息</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select ename,sal </span><br><span class="line">    -&gt; from emp </span><br><span class="line">    -&gt; where </span><br><span class="line">    -&gt; sal&gt;(select sal from emp where ename = 'smith');</span><br><span class="line">+<span class="comment">--------+---------+</span></span><br><span class="line">| ename  | sal     |</span><br><span class="line">+<span class="comment">--------+---------+</span></span><br><span class="line">| ALLEN  | 1600.00 |</span><br><span class="line">| WARD   | 1250.00 |</span><br><span class="line">| JONES  | 2975.00 |</span><br><span class="line">| MARTIN | 1250.00 |</span><br><span class="line">| BLAKE  | 2850.00 |</span><br><span class="line">| CLARK  | 2450.00 |</span><br><span class="line">| SCOTT  | 3000.00 |</span><br><span class="line">| KING   | 5000.00 |</span><br><span class="line">| TURNER | 1500.00 |</span><br><span class="line">| ADAMS  | 1100.00 |</span><br><span class="line">| JAMES  |  950.00 |</span><br><span class="line">| FORD   | 3000.00 |</span><br><span class="line">| MILLER | 1300.00 |</span><br><span class="line">+<span class="comment">--------+---------+</span></span><br><span class="line">13 rows in <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure>
<h5 id="列出所有’CLERK’的姓名及其部门名称，部门的人数"><a href="#列出所有’CLERK’的姓名及其部门名称，部门的人数" class="headerlink" title="列出所有’CLERK’的姓名及其部门名称，部门的人数"></a>列出所有’CLERK’的姓名及其部门名称，部门的人数</h5><p>先找出所有的’CLERK’</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select ename,job,deptno from emp where job = 'clerk';</span><br><span class="line">+<span class="comment">--------+-------+--------+</span></span><br><span class="line">| ename  | job   | deptno |</span><br><span class="line">+<span class="comment">--------+-------+--------+</span></span><br><span class="line">| SMITH  | CLERK |     20 |</span><br><span class="line">| ADAMS  | CLERK |     20 |</span><br><span class="line">| JAMES  | CLERK |     30 |</span><br><span class="line">| MILLER | CLERK |     10 |</span><br><span class="line">+<span class="comment">--------+-------+--------+</span></span><br></pre></td></tr></table></figure>
<p>连接dept表找出所有’CLERK’的部门名称</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select e.ename,e.job,d.dname,e.deptno</span><br><span class="line">    -&gt; from emp e</span><br><span class="line">    -&gt; join dept d</span><br><span class="line">    -&gt; on d.deptno=e.deptno</span><br><span class="line">    -&gt; where e.job='clerk';</span><br><span class="line">+<span class="comment">--------+-------+------------+--------+</span></span><br><span class="line">| ename  | job   | dname      | deptno |</span><br><span class="line">+<span class="comment">--------+-------+------------+--------+</span></span><br><span class="line">| SMITH  | CLERK | RESEARCH   |     20 |</span><br><span class="line">| ADAMS  | CLERK | RESEARCH   |     20 |</span><br><span class="line">| JAMES  | CLERK | SALES      |     30 |</span><br><span class="line">| MILLER | CLERK | ACCOUNTING |     10 |</span><br><span class="line">+<span class="comment">--------+-------+------------+--------+</span></span><br><span class="line">4 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>找出每个部门的人数</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select deptno,count(*) from emp group by deptno;</span><br><span class="line">+<span class="comment">--------+----------+</span></span><br><span class="line">| deptno | count(*) |</span><br><span class="line">+<span class="comment">--------+----------+</span></span><br><span class="line">|     20 |        5 |</span><br><span class="line">|     30 |        6 |</span><br><span class="line">|     10 |        3 |</span><br><span class="line">+<span class="comment">--------+----------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>使用这张表和上一张表做连接</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select t1.*,t2.deptcount</span><br><span class="line">    -&gt; from (select e.ename,e.job,d.dname,e.deptno from emp e join dept d on d.deptno=e.deptno where e.job='clerk') t1</span><br><span class="line">    -&gt; join (select deptno,count(*) as deptcount from emp group by deptno) t2</span><br><span class="line">    -&gt; on</span><br><span class="line">    -&gt; t1.deptno=t2.deptno;</span><br><span class="line">+<span class="comment">--------+-------+------------+--------+-----------+</span></span><br><span class="line">| ename  | job   | dname      | deptno | deptcount |</span><br><span class="line">+<span class="comment">--------+-------+------------+--------+-----------+</span></span><br><span class="line">| SMITH  | CLERK | RESEARCH   |     20 |         5 |</span><br><span class="line">| ADAMS  | CLERK | RESEARCH   |     20 |         5 |</span><br><span class="line">| JAMES  | CLERK | SALES      |     30 |         6 |</span><br><span class="line">| MILLER | CLERK | ACCOUNTING |     10 |         3 |</span><br><span class="line">+<span class="comment">--------+-------+------------+--------+-----------+</span></span><br><span class="line">4 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<h5 id="列出最低薪资大于1500的各种工作及从事此工作的全部雇员人数"><a href="#列出最低薪资大于1500的各种工作及从事此工作的全部雇员人数" class="headerlink" title="列出最低薪资大于1500的各种工作及从事此工作的全部雇员人数"></a>列出最低薪资大于1500的各种工作及从事此工作的全部雇员人数</h5><p>按照工作岗位分组并计数，使用<code>having</code>统计最低薪资大于1500的人</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select job,count(*) from emp group by job having min(sal) &gt; 1500;</span><br><span class="line">+<span class="comment">-----------+----------+</span></span><br><span class="line">| job       | count(*) |</span><br><span class="line">+<span class="comment">-----------+----------+</span></span><br><span class="line">| MANAGER   |        3 |</span><br><span class="line">| ANALYST   |        2 |</span><br><span class="line">| PRESIDENT |        1 |</span><br><span class="line">+<span class="comment">-----------+----------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<h5 id="列出薪资高于公司平均薪资的所有员工，所在部门，上级领导，雇员的工资等级"><a href="#列出薪资高于公司平均薪资的所有员工，所在部门，上级领导，雇员的工资等级" class="headerlink" title="列出薪资高于公司平均薪资的所有员工，所在部门，上级领导，雇员的工资等级"></a>列出薪资高于公司平均薪资的所有员工，所在部门，上级领导，雇员的工资等级</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select e.ename '员工',d.dname,l.ename '领导',s.grade</span><br><span class="line">    -&gt; from emp e</span><br><span class="line">    -&gt; join dept d</span><br><span class="line">    -&gt; on e.deptno = d.deptno</span><br><span class="line">    -&gt; left join </span><br><span class="line">    -&gt; emp l</span><br><span class="line">    -&gt; on e.mgr = l.empno</span><br><span class="line">    -&gt; join salgrade s</span><br><span class="line">    -&gt; on e.sal between s.losal and s.hisal</span><br><span class="line">    -&gt; where e.sal &gt; (select avg(sal) from emp);</span><br><span class="line">+<span class="comment">--------+------------+--------+-------+</span></span><br><span class="line">| 员工   | dname      | 领导   | grade |</span><br><span class="line">+<span class="comment">--------+------------+--------+-------+</span></span><br><span class="line">| FORD   | RESEARCH   | JONES  |     4 |</span><br><span class="line">| SCOTT  | RESEARCH   | JONES  |     4 |</span><br><span class="line">| CLARK  | ACCOUNTING | KING   |     4 |</span><br><span class="line">| BLAKE  | SALES      | KING   |     4 |</span><br><span class="line">| JONES  | RESEARCH   | KING   |     4 |</span><br><span class="line">| KING   | ACCOUNTING | NULL   |     5 |</span><br><span class="line">+<span class="comment">--------+------------+--------+-------+</span></span><br><span class="line">6 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<h5 id="列出与’SCOTT’从事相同工作的所有员工及部门名称"><a href="#列出与’SCOTT’从事相同工作的所有员工及部门名称" class="headerlink" title="列出与’SCOTT’从事相同工作的所有员工及部门名称"></a>列出与’SCOTT’从事相同工作的所有员工及部门名称</h5><p>第一步，找出’SCOTT’从事的工作</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select job from emp where ename = 'scott';</span><br><span class="line">+<span class="comment">---------+</span></span><br><span class="line">| job     |</span><br><span class="line">+<span class="comment">---------+</span></span><br><span class="line">| ANALYST |</span><br><span class="line">+<span class="comment">---------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>第二步，连接dept表，找出和’SCOTT’从事相同工作的人和部门名称</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select e.ename,d.dname</span><br><span class="line">    -&gt; from emp e</span><br><span class="line">    -&gt; join dept d</span><br><span class="line">    -&gt; on e.deptno = d.deptno</span><br><span class="line">    -&gt; where</span><br><span class="line">    -&gt; e.job = (select job from emp where ename = 'scott')</span><br><span class="line">    -&gt; and e.ename != 'scott';</span><br><span class="line">+<span class="comment">-------+----------+</span></span><br><span class="line">| ename | dname    |</span><br><span class="line">+<span class="comment">-------+----------+</span></span><br><span class="line">| FORD  | RESEARCH |</span><br><span class="line">+<span class="comment">-------+----------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<h5 id="列出薪资等于部门30中员工的薪资的其他员工的姓名和薪资"><a href="#列出薪资等于部门30中员工的薪资的其他员工的姓名和薪资" class="headerlink" title="列出薪资等于部门30中员工的薪资的其他员工的姓名和薪资"></a>列出薪资等于部门30中员工的薪资的其他员工的姓名和薪资</h5><p>第一步，找出部门30的所有薪资</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select distinct sal from emp where deptno = 30;</span><br><span class="line">+<span class="comment">---------+</span></span><br><span class="line">| sal     |</span><br><span class="line">+<span class="comment">---------+</span></span><br><span class="line">| 1600.00 |</span><br><span class="line">| 1250.00 |</span><br><span class="line">| 2850.00 |</span><br><span class="line">| 1500.00 |</span><br><span class="line">|  950.00 |</span><br><span class="line">+<span class="comment">---------+</span></span><br><span class="line">5 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>第二步，找出其他员工的姓名和薪资</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select distinct sal from emp where deptno = 30;</span><br><span class="line">+<span class="comment">---------+</span></span><br><span class="line">| sal     |</span><br><span class="line">+<span class="comment">---------+</span></span><br><span class="line">| 1600.00 |</span><br><span class="line">| 1250.00 |</span><br><span class="line">| 2850.00 |</span><br><span class="line">| 1500.00 |</span><br><span class="line">|  950.00 |</span><br><span class="line">+<span class="comment">---------+</span></span><br><span class="line">5 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> ename,sal </span><br><span class="line">    -&gt; <span class="keyword">from</span> emp</span><br><span class="line">    -&gt; <span class="keyword">where</span> sal <span class="keyword">in</span>(<span class="keyword">select</span> <span class="keyword">distinct</span> sal <span class="keyword">from</span> emp <span class="keyword">where</span> deptno = <span class="number">30</span>)</span><br><span class="line">    -&gt; <span class="keyword">and</span> deptno &lt;&gt; <span class="number">30</span>;</span><br><span class="line">Empty <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<h5 id="列出在每个部门工作的员工数量，平均工资和平均服务期限"><a href="#列出在每个部门工作的员工数量，平均工资和平均服务期限" class="headerlink" title="列出在每个部门工作的员工数量，平均工资和平均服务期限"></a>列出在每个部门工作的员工数量，平均工资和平均服务期限</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select d.deptno,count(e.ename),ifnull(avg(e.sal),0) '平均薪资',avg(TimeStampDiff(year,hiredate,now())) '服务期限'</span><br><span class="line">    -&gt; from emp e</span><br><span class="line">    -&gt; right join dept d</span><br><span class="line">    -&gt; on e.deptno = d.deptno</span><br><span class="line">    -&gt; group by d.deptno;</span><br><span class="line">+<span class="comment">--------+----------------+--------------+--------------+</span></span><br><span class="line">| deptno | count(e.ename) | 平均薪资     | 服务期限       |</span><br><span class="line">+<span class="comment">--------+----------------+--------------+--------------+</span></span><br><span class="line">|     10 |              3 |  2916.666667 |      39.6667 |</span><br><span class="line">|     20 |              5 |  2175.000000 |      37.4000 |</span><br><span class="line">|     30 |              6 |  1566.666667 |      39.8333 |</span><br><span class="line">|     40 |              0 |     0.000000 |         NULL |</span><br><span class="line">+<span class="comment">--------+----------------+--------------+--------------+</span></span><br><span class="line">4 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<h5 id="求出员工领导的薪水超过3000的员工名称与领导"><a href="#求出员工领导的薪水超过3000的员工名称与领导" class="headerlink" title="求出员工领导的薪水超过3000的员工名称与领导"></a>求出员工领导的薪水超过3000的员工名称与领导</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select e.ename,l.ename,l.sal</span><br><span class="line">    -&gt; from emp e</span><br><span class="line">    -&gt; left join emp l</span><br><span class="line">    -&gt; on e.mgr = l.empno</span><br><span class="line">    -&gt; where l.sal&gt;3000;</span><br><span class="line">+<span class="comment">-------+-------+---------+</span></span><br><span class="line">| ename | ename | sal     |</span><br><span class="line">+<span class="comment">-------+-------+---------+</span></span><br><span class="line">| JONES | KING  | 5000.00 |</span><br><span class="line">| BLAKE | KING  | 5000.00 |</span><br><span class="line">| CLARK | KING  | 5000.00 |</span><br><span class="line">+<span class="comment">-------+-------+---------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<h5 id="求部门名称中，带’S’字符的部门员工的工资合计、部门人数"><a href="#求部门名称中，带’S’字符的部门员工的工资合计、部门人数" class="headerlink" title="求部门名称中，带’S’字符的部门员工的工资合计、部门人数"></a>求部门名称中，带’S’字符的部门员工的工资合计、部门人数</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select d.deptno,d.dname,d.loc,count(e.ename),ifnull(sum(e.sal),0)</span><br><span class="line">    -&gt; from emp e</span><br><span class="line">    -&gt; right join dept d</span><br><span class="line">    -&gt; on e.deptno = d.deptno</span><br><span class="line">    -&gt; where d.dname like '%S%'</span><br><span class="line">    -&gt; group by d.deptno,d.dname,d.loc;</span><br><span class="line">+<span class="comment">--------+------------+---------+----------------+----------------------+</span></span><br><span class="line">| deptno | dname      | loc     | count(e.ename) | ifnull(sum(e.sal),0) |</span><br><span class="line">+<span class="comment">--------+------------+---------+----------------+----------------------+</span></span><br><span class="line">|     20 | RESEARCH   | DALLAS  |              5 |             10875.00 |</span><br><span class="line">|     30 | SALES      | CHICAGO |              6 |              9400.00 |</span><br><span class="line">|     40 | OPERATIONS | BOSTON  |              0 |                 0.00 |</span><br><span class="line">+<span class="comment">--------+------------+---------+----------------+----------------------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Notes/" rel="tag"># Notes</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2021/01/18/Redis学习/" rel="next" title="Redis学习">
                <i class="fa fa-chevron-left"></i> Redis学习
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2021/01/23/SeqGAN论文笔记/" rel="prev" title="SeqGAN论文笔记">
                SeqGAN论文笔记 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/author2.png" alt="Elssm">
            
              <p class="site-author-name" itemprop="name">Elssm</p>
              <p class="site-description motion-element" itemprop="description">Web/Cloud/ML Security  Adversarial Training</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">89</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">14</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/elssm" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-globe"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://leetcode.cn/u/elssm/" target="_blank" title="Leetcode">
                      
                        <i class="fa fa-fw fa-globe"></i>Leetcode</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#mysql逻辑架构"><span class="nav-number">1.</span> <span class="nav-text">mysql逻辑架构</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#索引失效（避免索引失效）"><span class="nav-number">2.</span> <span class="nav-text">索引失效（避免索引失效）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#MySQL题目"><span class="nav-number">3.</span> <span class="nav-text">MySQL题目</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#取得每个部门最高薪水的人员名称"><span class="nav-number">3.1.</span> <span class="nav-text">取得每个部门最高薪水的人员名称</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#哪些人的薪水在部门的平均薪水之上"><span class="nav-number">3.2.</span> <span class="nav-text">哪些人的薪水在部门的平均薪水之上</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#取得部门中-所有人的-平均的薪水等级"><span class="nav-number">3.3.</span> <span class="nav-text">取得部门中(所有人的)平均的薪水等级</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#不使用max函数，取得最高薪水"><span class="nav-number">3.4.</span> <span class="nav-text">不使用max函数，取得最高薪水</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#取得平均薪水最高的部门的部门编号"><span class="nav-number">3.5.</span> <span class="nav-text">取得平均薪水最高的部门的部门编号</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#取得平均薪水最高的部门的部门名称"><span class="nav-number">3.6.</span> <span class="nav-text">取得平均薪水最高的部门的部门名称</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#找出平均薪水的等级最低的部门的部门名称"><span class="nav-number">3.7.</span> <span class="nav-text">找出平均薪水的等级最低的部门的部门名称</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#取出比普通员工-员工代码没有在mgr字段上出现的-的最高薪水还要高的领导人姓名"><span class="nav-number">3.8.</span> <span class="nav-text">取出比普通员工(员工代码没有在mgr字段上出现的)的最高薪水还要高的领导人姓名</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#取得每个薪水等级有多少员工"><span class="nav-number">3.9.</span> <span class="nav-text">取得每个薪水等级有多少员工</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#列出所有员工及领导的姓名"><span class="nav-number">3.10.</span> <span class="nav-text">列出所有员工及领导的姓名</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#找出受雇日期早于其直接上级的所有员工的编号，姓名，部门名称"><span class="nav-number">3.11.</span> <span class="nav-text">找出受雇日期早于其直接上级的所有员工的编号，姓名，部门名称</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#列出部门名称和这些部门的员工信息"><span class="nav-number">3.12.</span> <span class="nav-text">列出部门名称和这些部门的员工信息</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#列出至少有5个员工的所有部门"><span class="nav-number">3.13.</span> <span class="nav-text">列出至少有5个员工的所有部门</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#列出薪资比’SMITH’多的所有员工信息"><span class="nav-number">3.14.</span> <span class="nav-text">列出薪资比’SMITH’多的所有员工信息</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#列出所有’CLERK’的姓名及其部门名称，部门的人数"><span class="nav-number">3.15.</span> <span class="nav-text">列出所有’CLERK’的姓名及其部门名称，部门的人数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#列出最低薪资大于1500的各种工作及从事此工作的全部雇员人数"><span class="nav-number">3.16.</span> <span class="nav-text">列出最低薪资大于1500的各种工作及从事此工作的全部雇员人数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#列出薪资高于公司平均薪资的所有员工，所在部门，上级领导，雇员的工资等级"><span class="nav-number">3.17.</span> <span class="nav-text">列出薪资高于公司平均薪资的所有员工，所在部门，上级领导，雇员的工资等级</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#列出与’SCOTT’从事相同工作的所有员工及部门名称"><span class="nav-number">3.18.</span> <span class="nav-text">列出与’SCOTT’从事相同工作的所有员工及部门名称</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#列出薪资等于部门30中员工的薪资的其他员工的姓名和薪资"><span class="nav-number">3.19.</span> <span class="nav-text">列出薪资等于部门30中员工的薪资的其他员工的姓名和薪资</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#列出在每个部门工作的员工数量，平均工资和平均服务期限"><span class="nav-number">3.20.</span> <span class="nav-text">列出在每个部门工作的员工数量，平均工资和平均服务期限</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#求出员工领导的薪水超过3000的员工名称与领导"><span class="nav-number">3.21.</span> <span class="nav-text">求出员工领导的薪水超过3000的员工名称与领导</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#求部门名称中，带’S’字符的部门员工的工资合计、部门人数"><span class="nav-number">3.22.</span> <span class="nav-text">求部门名称中，带’S’字符的部门员工的工资合计、部门人数</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Elssm</span>

  
</div>






  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a></div>



<span id="busuanzi_container_site_pv" class="theme-info">
&nbsp;&nbsp;|&nbsp;&nbsp;本站总访问量<span id="busuanzi_value_site_pv"></span>次
  </span>
  <span id="busuanzi_container_site_uv" class="theme-info">
&nbsp;&nbsp;|&nbsp;&nbsp;本站访客数<span id="busuanzi_value_site_uv"></span>人次
  </span>

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->



  


  




	





  





  












  





  

  

  

  
  

  
  


  

  

</body>
</html>
